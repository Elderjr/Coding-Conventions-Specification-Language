[comment encoding = UTF-8 /]
[module methodInvocationModule('http://www.example.org/ccsl') extends org::ccsl::gen::ocl::elements::statements::statementModule /]
[import org::ccsl::gen::ocl::dispatchers::dispatcherModule /]

[import org::gen::ocl::strings::stringModule /]


[template public generateSelect(methodInvocation: MethodInvocation, filters: OrderedSet(AtomicFilter)) overrides generateSelect]
MethodInvocation.allInstances()
  ->select(inv: MethodInvocation |
    [methodInvocation.generateConditions(null, 'inv', filters, false, false) /]
)
[/template]

[query public getAllMethodInvocationConditions(methodInvocation: MethodInvocation, contextElement: Element, varName: String, filters: OrderedSet(AtomicFilter), exactMatch: Boolean): Set(String) =
Set(String){
  	methodInvocation.generateMethodCondition(contextElement, varName, filters, exactMatch)
}
->select(condition: String | condition.trim().size() > 0)
->union(methodInvocation.getAllStatementConditions(contextElement, varName, filters, exactMatch))
/]

[template public generateConditions(methodInvocation: MethodInvocation, contextElement: Element, varName: String, filters: OrderedSet(AtomicFilter), exactMatch: Boolean, typeCheck: Boolean) overrides generateConditions]
( -- Method Invocation conditions
[for (condition: String | methodInvocation.getAllMethodInvocationConditions(contextElement, varName, filters, exactMatch)) separator(' and \n')]
  [condition.printStringWithIdentation() /][/for]

) --End Method Invocation conditions
[/template]

[template private generateMethodCondition(methodInvocation: MethodInvocation, contextElement: Element, varName: String, filters: OrderedSet(AtomicFilter), exactMatch: Boolean)]
[if (not methodInvocation.elementAccessed.oclIsUndefined()) and (methodInvocation.elementAccessed <> contextElement))]
[/if]
[comment methodInvocation.generateGenericSingleAttributeCondition(contextElement, varName, filters, false, false, methodInvocation.elementAccessed.oclAsType(Method), 'method') /]
[/template]

